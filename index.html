<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√µ ƒê√†i Ng∆∞·ªùi Que - Campaign</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6467f2",
                        "primary-glow": "#8a8dff",
                        "background-dark": "#101122",
                        "surface-dark": "#1e1f3a",
                        "neon-pink": "#ff2a6d",
                        "neon-cyan": "#05d9e8",
                    },
                    fontFamily: {
                        "display": ["Spline Sans", "sans-serif"]
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'glow-pulse': 'glowPulse 3s infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/new-ui.css">
    
    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- New Battle HUD with Cyberpunk Style -->
        <div class="relative z-20 flex items-start justify-between w-full gap-4 p-4 md:p-6" id="game-header">
            <!-- Player 1 (Left) -->
            <div class="flex flex-1 items-center gap-3 max-w-md">
                <div class="flex-1 flex flex-col gap-2">
                    <div class="flex justify-between items-center px-1">
                        <h2 class="text-white text-sm md:text-base font-bold tracking-tight uppercase" id="player-name">PLAYER 1</h2>
                        <span class="text-cyan-400 text-xs md:text-sm font-bold" id="player1-percent">100%</span>
                    </div>
                    <!-- Health Bar -->
                    <div class="relative h-6 md:h-7 w-full bg-slate-900/80 border-l-4 border-cyan-500 rounded-r-sm overflow-hidden backdrop-blur-sm shadow-[0_0_10px_rgba(0,0,0,0.5)]">
                        <div class="absolute top-0 left-0 h-full bg-gradient-to-r from-cyan-600 via-cyan-400 to-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.6)] transition-all duration-300 ease-out" id="player1-health" style="width: 100%"></div>
                    </div>
                    <!-- Coins Display -->
                    <div class="flex items-center gap-2 text-xs text-yellow-400">
                        <span class="sparkle-icon">üí∞</span>
                        <span id="coins" class="font-bold">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Center Timer -->
            <div class="flex flex-col items-center justify-start -mt-2">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-slate-900/90 rounded-xl border-2 border-primary shadow-neon-primary flex items-center justify-center relative overflow-hidden backdrop-blur-md">
                    <div class="absolute inset-0 bg-primary/10 animate-pulse-fast"></div>
                    <span class="text-3xl md:text-4xl font-black text-white leading-none z-10" id="timer">180</span>
                </div>
                <div class="mt-2 px-3 py-1 bg-primary/20 border border-primary/40 rounded text-xs font-bold text-primary uppercase tracking-wider backdrop-blur-sm" id="stage-number">
                    Stage 1
                </div>
            </div>
            
            <!-- Player 2 (Right) -->
            <div class="flex flex-1 items-center justify-end gap-3 max-w-md">
                <div class="flex-1 flex flex-col gap-2">
                    <div class="flex justify-between items-center px-1 flex-row-reverse">
                        <h2 class="text-white text-sm md:text-base font-bold tracking-tight uppercase" id="opponent-name">OPPONENT</h2>
                        <span class="text-fuchsia-400 text-xs md:text-sm font-bold" id="player2-percent">100%</span>
                    </div>
                    <!-- Health Bar -->
                    <div class="relative h-6 md:h-7 w-full bg-slate-900/80 border-r-4 border-fuchsia-500 rounded-l-sm overflow-hidden backdrop-blur-sm shadow-[0_0_10px_rgba(0,0,0,0.5)]">
                        <div class="absolute top-0 right-0 h-full bg-gradient-to-l from-fuchsia-600 via-fuchsia-500 to-fuchsia-300 shadow-[0_0_15px_rgba(217,70,239,0.6)] transition-all duration-300 ease-out" id="player2-health" style="width: 100%"></div>
                    </div>
                    <!-- AI Indicator -->
                    <div class="text-right text-xs text-gray-400">
                        <span class="font-medium">AI Enemy</span>
                    </div>
                </div>
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>
        
        <!-- Main Menu Overlay (New Design) -->
        <div class="game-overlay" id="mainMenu">
            <!-- Animated Background -->
            <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
                <div class="absolute inset-0 top-1/2 -bottom-1/2 w-full h-full bg-grid-pattern perspective-grid opacity-15"></div>
                <div class="absolute top-0 left-1/4 w-96 h-96 bg-primary/20 rounded-full blur-[128px] animate-pulse-fast"></div>
                <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-neon-cyan/10 rounded-full blur-[128px] animate-pulse-fast"></div>
                <!-- Floating particles -->
                <div class="particle w-1 h-1 top-1/4 left-1/4 animate-float bg-white"></div>
                <div class="particle w-2 h-2 top-3/4 left-2/3 animate-float-delayed bg-neon-pink"></div>
                <div class="particle w-1 h-1 top-1/2 left-1/2 animate-float bg-neon-cyan"></div>
            </div>
            
            <div class="relative z-10 flex flex-col h-full items-center justify-center p-6 gap-8">
                <!-- Logo -->
                <div class="text-center mb-4 opacity-0 animate-fade-in-up">
                    <h1 class="text-5xl md:text-6xl font-black tracking-tighter italic text-white text-glow uppercase">
                        STICKMAN <span class="text-primary inline-block animate-glow-pulse">ARENA</span>
                    </h1>
                    <div class="h-1 w-48 bg-primary mx-auto mt-4 rounded-full shadow-neon-primary"></div>
                </div>
                
                <!-- Stats Display -->
                <div class="glass-card px-8 py-4 rounded-full flex items-center gap-8 mb-4 opacity-0 animate-fade-in-up stagger-1">
                    <div class="flex items-center gap-3 group cursor-default">
                        <div class="size-8 rounded-full bg-neon-cyan/20 flex items-center justify-center group-hover:rotate-[360deg] transition-transform duration-700">
                            <span class="text-neon-cyan text-xl">üèÜ</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-slate-400 uppercase tracking-wider font-bold">Wins</span>
                            <span class="text-base font-bold text-white" id="victories">0</span>
                        </div>
                    </div>
                    <div class="h-8 w-px bg-white/10"></div>
                    <div class="flex items-center gap-3 group cursor-default">
                        <div class="size-8 rounded-full bg-yellow-500/20 flex items-center justify-center group-hover:animate-bounce">
                            <span class="text-yellow-400 text-xl sparkle-icon">üí∞</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xs text-slate-400 uppercase tracking-wider font-bold">Coins</span>
                            <span class="text-base font-bold text-white" id="menu-coins">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Menu Buttons -->
                <div class="flex flex-col gap-4 w-full max-w-md opacity-0 animate-fade-in-up stagger-2">
                    <button class="glass-card group relative overflow-hidden rounded-xl p-6 cursor-pointer hover:z-20 ripple-btn neon-button" id="campaignBtn">
                        <div class="absolute top-0 left-0 w-1 h-full bg-primary opacity-50 group-hover:opacity-100 transition-opacity"></div>
                        <div class="flex justify-between items-center relative z-10">
                            <div class="flex flex-col gap-1 text-left">
                                <span class="text-xs font-bold tracking-[0.2em] text-primary group-hover:text-white transition-colors">STORY MODE</span>
                                <h2 class="text-2xl font-black italic text-white">üìñ CAMPAIGN</h2>
                            </div>
                            <span class="text-3xl transition-all duration-300 group-hover:scale-125 group-hover:rotate-12">‚öîÔ∏è</span>
                        </div>
                    </button>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button class="glass-card p-5 rounded-xl hover:border-primary transition-all ripple-btn" id="vsBtn">
                            <div class="text-3xl mb-2">‚öîÔ∏è</div>
                            <div class="text-sm font-bold text-white uppercase">VS Mode</div>
                        </button>
                        <button class="glass-card p-5 rounded-xl hover:border-primary transition-all ripple-btn" id="shopBtn">
                            <div class="text-3xl mb-2">üè™</div>
                            <div class="text-sm font-bold text-white uppercase">Shop</div>
                        </button>
                    </div>
                    
                    <button class="btn-glass btn-base text-sm" id="resetBtn">
                        üîÑ Reset Progress
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Stage Select -->
        <div class="game-overlay hidden" id="stageSelect">
            <div class="flex flex-col items-center justify-center min-h-screen p-6 pt-20">
                <!-- Header -->
                <div class="text-center mb-8 opacity-0 animate-fade-in-down">
                    <h1 class="text-5xl md:text-6xl font-black italic mb-3 neon-text-glow">
                        üìñ STAGE SELECT
                    </h1>
                    <p class="text-slate-300 font-semibold tracking-wide">Choose your battleground</p>
                </div>
                
                <!-- Stage Grid -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full max-w-5xl mb-6 opacity-0 animate-fade-in-up stagger-1" id="stageGrid">
                    <!-- Stages will be populated by UIManager.populateStageSelection() -->
                </div>
                
                <!-- Back Button -->
                <button class="btn-glass btn-base opacity-0 animate-fade-in-up stagger-2" id="backToMenu">
                    <span class="material-icons text-lg mr-2">arrow_back</span>
                    Back to Menu
                </button>
            </div>
        </div>
        
        <!-- Upgrade Shop -->
        <div class="game-overlay hidden" id="upgradeShop">
            <div class="flex flex-col items-center justify-center min-h-screen p-6 pt-20">
                <!-- Header -->
                <div class="text-center mb-6 opacity-0 animate-fade-in-down">
                    <h1 class="text-5xl md:text-6xl font-black italic mb-3 neon-text-glow">
                        üè™ UPGRADE SHOP
                    </h1>
                    <div class="flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-500/20 to-yellow-500/20 border border-amber-400/40 rounded-xl backdrop-blur-md">
                        <span class="text-3xl">üí∞</span>
                        <span class="text-2xl font-black text-amber-400" id="shop-coins">0</span>
                        <span class="text-sm text-amber-300 font-bold">COINS</span>
                    </div>
                </div>
                
                <!-- Upgrade Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-6xl mb-6 opacity-0 animate-fade-in-up stagger-1">
                    <!-- Health Upgrade -->
                    <div class="upgrade-card group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-md border border-slate-700/50 p-6 transition-all hover:scale-105 hover:border-red-500/60">
                        <div class="absolute inset-0 bg-gradient-to-br from-red-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div class="relative z-10">
                            <div class="text-5xl mb-3 transition-transform group-hover:scale-110">‚ù§Ô∏è</div>
                            <h3 class="text-xl font-black text-white mb-2 uppercase">Max Health</h3>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="px-3 py-1 bg-red-500/20 border border-red-500/40 rounded text-sm font-bold text-red-400">
                                    Lv <span id="health-level">0</span>/5
                                </span>
                            </div>
                            <p class="text-sm text-slate-300 mb-4">+10 HP per level</p>
                            
                            <!-- Progress Bar -->
                            <div class="w-full h-2 bg-slate-800 rounded-full mb-4 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-red-600 to-pink-500 transition-all duration-500" id="health-progress" style="width: 0%"></div>
                            </div>
                            
                            <button class="btn-glass btn-base w-full" id="upgrade-health">
                                <span class="mr-2">üí∞</span>
                                <span id="health-cost">200</span> Coins
                            </button>
                        </div>
                    </div>
                    
                    <!-- Attack Upgrade -->
                    <div class="upgrade-card group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-md border border-slate-700/50 p-6 transition-all hover:scale-105 hover:border-orange-500/60">
                        <div class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-red-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div class="relative z-10">
                            <div class="text-5xl mb-3 transition-transform group-hover:scale-110">‚öîÔ∏è</div>
                            <h3 class="text-xl font-black text-white mb-2 uppercase">Attack Power</h3>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="px-3 py-1 bg-orange-500/20 border border-orange-500/40 rounded text-sm font-bold text-orange-400">
                                    Lv <span id="attack-level">0</span>/5
                                </span>
                            </div>
                            <p class="text-sm text-slate-300 mb-4">+2 DMG per level</p>
                            
                            <div class="w-full h-2 bg-slate-800 rounded-full mb-4 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-orange-600 to-red-500 transition-all duration-500" id="attack-progress" style="width: 0%"></div>
                            </div>
                            
                            <button class="btn-glass btn-base w-full" id="upgrade-attack">
                                <span class="mr-2">üí∞</span>
                                <span id="attack-cost">250</span> Coins
                            </button>
                        </div>
                    </div>
                    
                    <!-- Speed Upgrade -->
                    <div class="upgrade-card group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-md border border-slate-700/50 p-6 transition-all hover:scale-105 hover:border-cyan-500/60">
                        <div class="absolute inset-0 bg-gradient-to-br from-cyan-500/10 to-blue-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div class="relative z-10">
                            <div class="text-5xl mb-3 transition-transform group-hover:scale-110">‚ö°</div>
                            <h3 class="text-xl font-black text-white mb-2 uppercase">Speed</h3>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="px-3 py-1 bg-cyan-500/20 border border-cyan-500/40 rounded text-sm font-bold text-cyan-400">
                                    Lv <span id="speed-level">0</span>/5
                                </span>
                            </div>
                            <p class="text-sm text-slate-300 mb-4">+0.5 SPD per level</p>
                            
                            <div class="w-full h-2 bg-slate-800 rounded-full mb-4 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-cyan-600 to-blue-500 transition-all duration-500" id="speed-progress" style="width: 0%"></div>
                            </div>
                            
                            <button class="btn-glass btn-base w-full" id="upgrade-speed">
                                <span class="mr-2">üí∞</span>
                                <span id="speed-cost">150</span> Coins
                            </button>
                        </div>
                    </div>
                    
                    <!-- Defense Upgrade -->
                    <div class="upgrade-card group relative overflow-hidden rounded-xl bg-gradient-to-br from-slate-800/80 to-slate-900/80 backdrop-blur-md border border-slate-700/50 p-6 transition-all hover:scale-105 hover:border-purple-500/60">
                        <div class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-blue-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div class="relative z-10">
                            <div class="text-5xl mb-3 transition-transform group-hover:scale-110">üõ°Ô∏è</div>
                            <h3 class="text-xl font-black text-white mb-2 uppercase">Defense</h3>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="px-3 py-1 bg-purple-500/20 border border-purple-500/40 rounded text-sm font-bold text-purple-400">
                                    Lv <span id="defense-level">0</span>/5
                                </span>
                            </div>
                            <p class="text-sm text-slate-300 mb-4">-10% DMG per level</p>
                            
                            <div class="w-full h-2 bg-slate-800 rounded-full mb-4 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-600 to-blue-500 transition-all duration-500" id="defense-progress" style="width: 0%"></div>
                            </div>
                            
                            <button class="btn-glass btn-base w-full" id="upgrade-defense">
                                <span class="mr-2">üí∞</span>
                                <span id="defense-cost">300</span> Coins
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Back Button -->
                <button class="btn-glass btn-base opacity-0 animate-fade-in-up stagger-2" id="backToMenuFromShop">
                    <span class="material-symbols-outlined text-lg mr-2">arrow_back</span>
                    Back to Menu
                </button>
            </div>
        </div>
        
        <!-- Story Cutscene -->
        <div class="game-overlay hidden" id="storyCutscene">
            <div class="menu story-menu">
                <h2 id="storyTitle">Stage 1</h2>
                <div class="story-content">
                    <div class="enemy-preview" id="enemyPreview"></div>
                    <p class="story-text" id="storyText"></p>
                    <div class="enemy-stats">
                        <div>Enemy: <span id="enemyName"></span></div>
                        <div>Difficulty: <span id="enemyDifficulty"></span></div>
                    </div>
                </div>
                <button class="btn-start" id="startFight">‚öîÔ∏è Chi·∫øn ƒê·∫•u!</button>
            </div>
        </div>
        
        <!-- Victory Screen -->
        <div class="game-overlay hidden" id="victoryScreen">
            <div class="menu victory-menu">
                <h1 class="victory-title">üéâ CHI·∫æN TH·∫ÆNG! üéâ</h1>
                <div class="victory-content">
                    <div class="reward-box">
                        <div class="reward-amount" id="rewardAmount">+500 üí∞</div>
                        <div>Total Coins: <span id="totalCoins">0</span> üí∞</div>
                    </div>
                </div>
                <div class="menu-buttons">
                    <button class="btn-menu" id="nextStageBtn">M√†n Ti·∫øp ‚ûú</button>
                    <button class="btn-menu" id="retryBtn">‚Üª Ch∆°i L·∫°i</button>
                    <button class="btn-menu" id="backToMenuFromVictory">‚Üê Menu</button>
                </div>
            </div>
        </div>
        
        <!-- Defeat Screen -->
        <div class="game-overlay hidden" id="defeatScreen">
            <div class="menu defeat-menu">
                <h1 class="defeat-title">üíÄ TH·∫§T B·∫†I</h1>
                <div class="defeat-content">
                    <p>ƒê·ª´ng b·ªè cu·ªôc! H√£y n√¢ng c·∫•p v√† th·ª≠ l·∫°i!</p>
                </div>
                <div class="menu-buttons">
                    <button class="btn-menu" id="retryDefeatBtn">‚Üª Th·ª≠ L·∫°i</button>
                    <button class="btn-menu" id="upgradeFromDefeat">üè™ N√¢ng C·∫•p</button>
                    <button class="btn-menu" id="backToMenuFromDefeat">‚Üê Menu</button>
                </div>
            </div>
        </div>
        
        <!-- VS Mode (2 Player) -->
        <div class="game-overlay hidden" id="vsMode">
            <div class="menu">
                <h1>‚öîÔ∏è VS MODE</h1>
                <button class="btn-start" id="startVsBtn">B·∫Øt ƒê·∫ßu</button>
                <div class="instructions">
                    <h3>H∆∞·ªõng d·∫´n ch∆°i:</h3>
                    <div class="instruction-row">
                        <div>
                            <strong>Player 1:</strong><br>
                            W/S: Nh·∫£y/Ng·ªìi<br>
                            A/D: Di chuy·ªÉn<br>
                            F: ƒê·∫•m<br>
                            G: ƒê√°
                        </div>
                        <div>
                            <strong>Player 2:</strong><br>
                            ‚Üë/‚Üì: Nh·∫£y/Ng·ªìi<br>
                            ‚Üê/‚Üí: Di chuy·ªÉn<br>
                            1: ƒê·∫•m<br>
                            2: ƒê√°
                        </div>
                    </div>
                </div>
                <button class="btn-back" id="backToMenuFromVs">‚Üê Quay L·∫°i</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Player Components -->
    <script src="js/components/PhysicsComponent.js"></script>
    <script src="js/components/CombatComponent.js"></script>
    <script src="js/components/ProjectileComponent.js"></script>
    <script src="js/components/AnimationComponent.js"></script>
    
    <!-- Game Systems -->
    <script src="js/core/GameEngine.js"></script>
    <script src="js/systems/RenderSystem.js"></script>
    <script src="js/systems/PowerUpSystem.js"></script>
    <script src="js/systems/CombatSystem.js"></script>
    
    <!-- Core Classes -->
    <script src="js/UIManager.js"></script>
    <script src="js/ParticleSystem.js"></script>
    <script src="js/Player.js"></script>
    <script src="js/AIController.js"></script>
    <script src="js/CampaignManager.js"></script>
    <script src="js/InputHandler.js"></script>
    <script src="js/Game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>